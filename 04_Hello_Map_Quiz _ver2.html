<!-- This is the corresponding "starter code" for 04_Hello Map in Udacity and Google's Maps
API Course, Lesson 1 -->
<html>
 <head>
   <meta charset="utf-8">
 <!-- styles put here, but you can include a CSS file and reference it instead! -->
   <style type="text/css">
     html, body { height: 100%; margin: 0; padding: 0; }
     
     #map {
      height: 100%;
      bottom: 0px;
      left: 362px;
      position: absolute;
      right: 0px;
     }

     .options-box{
       background: #fff;
       border: 1px solid #999;
       border-radius: 3px;
       height: 100%;
       line-height: 35px;
       padding: 10px 10px 30px 10px;
       text-align: left;
       width: 340px;
     }
   </style>
 </head>
 <body>
   <div class="container">
     <div class="options-box">
       <div>
         <input type="button" id="show-listings" value="Show Listings">
         <input type="button" id="hide-listings" value="Hide Listings">
       </div>
     </div>

     <div id="map"></div>
   </div>

   <script>
      var map;
      var markers = [];

      function initMap() {
         // Create a styles array to use with the map
         var styles = [
           {
             stylers: [
               { hue: "#00ffe6" },
               { saturation: -20 }
             ]
           },{
             featureType: "road",
             elementType: "geometry",
             stylers: [
               { lightness: 100 },
               { visibility: "simplified" }
             ]
           },{
             featureType: "road",
             elementType: "labels",
             stylers: [
               { visibility: "off" }
             ]
           }
         ];
         

         map = new google.maps.Map(document.getElementById('map'), {
           center: {lat: 37.491408, lng: 127.029124},
           zoom: 13,
           styles: styles,
           mapTypeControl: false
         });
         

         var locations = [
           {title: "GangNam CoffeeJiin", location: {lat: 37.491408, lng: 127.029124}},
           {title: "GangNam 5th gate", location: {lat: 37.495810, lng: 127.028499}},
           {title: "GangNam Giodano", location: {lat: 37.501271, lng: 127.024376}},
           {title: "GnagNam Gold Sushi", location: {lat: 37.492474, lng: 127.028650}}
         ];

         var largeInfowindow = new google.maps.InfoWindow();

         // Style the markers a bit. This will be our listing marker icon
         var defaultIcon = makeMarkerIcon('0091ff');

         // Create a "highlighted location" marker color for when the user
         // mouses over the marker.
         var highlightedIcon = makeMarkerIcon('FFFF24');
         
         var bounds = new google.maps.LatLngBounds(); //

         for(var i=0; i< locations.length; i++){
           var position = locations[i].location;
           var title = locations[i].title;

           var marker = new google.maps.Marker({
             position: position,
             map: map,
             title : title,
             icon: defaultIcon,
             animation: google.maps.Animation.DROP,
             id: i
           });

           markers.push(marker);
           bounds.extend(marker.position); //
           marker.addListener('click', function(){
             populateInfoWindow(this, largeInfowindow);
           });

           marker.addListener('mouseover', function(){
            this.setIcon(highlightedIcon);
           });

           marker.addListener('mouseout', function(){
            this.setIcon(defaultIcon);
           });

           markers[i].setMap(null);
         }

         map.fitBounds(bounds);
         
         document.getElementById('hide-listings').addEventListener('click', hideListings);
         document.getElementById('show-listings').addEventListener('click', showListings);
      }

      function populateInfoWindow(marker, infowindow){
        if(infowindow.marker != marker){
          infowindow.marker = marker;
          infowindow.setContent('<div>' + marker.title + '</div>');
          infowindow.open(map, marker);

          infowindow.addListener('closeclick', function(){
            infowindow.setMarker(null);
          });
          var streetViewService = new google.maps.StreetViewService();
          var radius = 50; //meter

          function getStreetView(data, status){
            console.log('getStreetView');
            if(status == google.maps.StreetViewStatus.OK){
               var nearStreetViewLocation = data.location.latLng;
               var heading = google.maps.geometry.spherical.computeHeading(
                  nearStreetViewLocation, marker.position);
               infowindow.setContent('<div>' + marker.title + '</div><div id="pano"></div>');
               var panoramaOptions = {
                  position: nearStreetViewLocation,
                  pov: {
                     heading: heading,
                     pitch: 30
                  }
               };
               var panorama = new google.maps.StreetViewPanorama(
                  document.getElementById('pano'), panoramaOptions);
            }else{
               infowindow.setContent('<div>' + marker.title + '</div>' +
                  '<div>No Street View Found</div>');
            }
          }

          streetViewService.getPanoramaByLocation(marker.position, radius, getStreetView);
          infowindow.open(map, marker);
        }
      }

      function showListings(){
        var bounds = new google.maps.LatLngBounds()
        
        // Extend the boundaries of the map for each marker and display the marker
        for(var i=0; i<markers.length; i++){
          markers[i].setMap(map);
          bounds.extend(markers[i].position);
        }
        map.fitBounds(bounds);
      }

      function hideListings(){
         for(var i=0; i<markers.length; i++){
            markers[i].setMap(null);
         }
      }

      function makeMarkerIcon(markerColor){
         var markerImage = new google.maps.MarkerImage(
            'http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+ markerColor+
            '|40|_|%E2%80%A2',
            new google.maps.Size(21, 34),
            new google.maps.Point(0, 0),
            new google.maps.Point(10, 34),
            new google.maps.Size(21, 34));
         return markerImage;
      }
   </script>

   <script async defer
    src="https://maps.googleapis.com/maps/api/js?libraries=geometry&key=AIzaSyBIkqvtFh0pIqMEl0PniMK8_ciIHAYnaS8&callback=initMap">
  </script>
   </script>
 </body>
</html>
